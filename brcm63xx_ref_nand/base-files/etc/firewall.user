# This file is interpreted as shell script.
# Put your custom iptables rules here, they will
# be executed with each firewall (re-)start.

# Internal uci firewall chains are flushed and recreated on reload, so
# put custom rules into the root chains e.g. INPUT or FORWARD or into the
# special user chains, e.g. input_wan_rule or postrouting_lan_rule.

# IPv4
iptables -t filter -I zone_wan_input -p udp -m udp --dport 68 -m comment --comment Allow-DHCP-Renew -j ACCEPT
iptables -t filter -I zone_wan_input -p icmp -m icmp --icmp-type 8 -m comment --comment Allow-Ping -j ACCEPT

# IPv6
ip6tables -t filter -I zone_wan_input -p udp -s fe80::/10 -d fe80::/10 -m udp --sport 547 --dport 546 -m comment --comment Allow-DHCPv6 -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 128 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 129 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 1 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 2 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 3 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 4/0 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 4/1 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 133 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 135 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 134 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_input -p icmpv6 -m icmp6 --icmpv6-type 136 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Input -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 128 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 129 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 1 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 2 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 3 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 4/0 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
ip6tables -t filter -I zone_wan_forward -p icmpv6 -m icmp6 --icmpv6-type 4/1 -m limit --limit 1000/sec -m comment --comment Allow-ICMPv6-Forward -j ACCEPT
